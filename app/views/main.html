<div class="header">
  <h3 class="text-muted">Till's Brandwatch challenge</h3>
</div>

<div class="row">
  <div id="statement" class="col-md-12">
    <img src="./content/images/letter_i.png" class="png">
    <img src="./content/images/black_heart.png" class="png" id="love">
    <img src="./content/images/logo_bw.png" class="png">
  </div>
</div>

<div class="row">
  <div class="panel panel-default" id="topics-panel" ng-if="dataReady">
    <div class="panel-heading">
      <h3 class="panel-title">My topics challenge</h3>
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="col-sm-9">
          <div ng-repeat="topic in preparedTopics">
            <div class="col-sm-{{topic.randomColumnSize}} word" ng-style="setStyle(topic)"><span ng-click="showInfo(topic)">{{topic
              .label}}</span></div>
          </div>
        </div>
        <div class="col-sm-3">
          <p>Information on topic <span class="info">"{{currentTopic.label}}":</span></p>
          <br>
          <p>Total mentions: <span class="info">{{currentTopic.volume}}</span></p>
          <br>
          <p>Positive mentions: <span class="info" id="positive-number">{{currentTopic.sentiment.positive}}</span></p>
          <p>Neutral mentions: <span class="info" id="neutral-number">{{currentTopic.sentiment.neutral}}</span></p>
          <p>Negative mentions: <span class="info" id="negative-number">{{currentTopic.sentiment.negative}}</span></p>
        </div>
      </div>
    </div>
  </div>
</div>

    <h3>Libraries / Frameworks used: AngularJS, Underscore.js - word-cloud is hand-made</h3>

    <h3>Interesting code just here: main.js</h3>
<pre class="prettyprint linenums">
'use strict';

angular.module('bwChallengeApp')

  //include Topics service in controller for data retrieval and preperation
  .controller('MainCtrl', function ($scope, Topics) {

    //create variable to see when data is loaded and prepared for showing (binds with ng-if in html)
    $scope.dataReady = false;

    //create empty current selected topic object
    $scope.currentTopic = {
      label: "",
      volume: "/ ",
      sentiment: {
        positive: "/ ",
        neutral: "/ ",
        negative: "/ "
      }
    };

    //show info of selected topic
    $scope.showInfo = function (topic) {
      $scope.currentTopic = topic;
    };


    //set styles for topics in cloud (works with ng-style in html)
    $scope.setStyle = function (topic) {
      return {'color': topic.sentimentTextColor, 'font-size': topic.popularityTextSize, 'text-align': topic.randomAlignment};
    };

    //get topics JSON file via service and prepare for viewing
    Topics.getJSON('./content/topics.json').success(function (data) {
      $scope.topics = data.topics;
      console.log('loading data finished');
      $scope.preparedTopics = Topics.prepare($scope.topics);
      console.log('preparing data finished');
      $scope.dataReady = true;
    });
  });
</pre>

<h3>topics.js</h3>
<pre class="prettyprint linenums">
'use strict';

angular.module('bwChallengeApp')

  .factory('Topics', ['$http', function ($http) {

    //functions for styling topics
    //add size to normal text size according to popularity
    function setTextSize(volume, classSizePopularity) {
      var textSize = 12;
      var extraPopularitySize = Math.floor(volume / classSizePopularity) * 5;
      return (textSize + extraPopularitySize);
    }

    //align words randomly within column
    function setRandomAlignment() {
      var alignments = ['left', 'center', 'right'];
      var num = (Math.floor(Math.random() * 3));
      return alignments[num];
    }

    //randomly assign column widths
    function setRandomColumnSize() {
      var comlumnSize = [3, 4];
      var num = (Math.floor(Math.random() * 2));
      return comlumnSize[num];
    }

    //set colors according to sentiment value
    function setSentimentTextColor(topic) {
      var fontColor = null;
      if (topic.sentimentScore < 40) {
        fontColor = "#ff0124"; //red
      } else if (topic.sentimentScore > 60) {
        fontColor = "#33be2a";  //green
      } else {
        fontColor = "#696969"; //grey
      }
      return fontColor;
    }

    var methods = {

      //http service to get JSON file - deferred success is accessed via main controller
      getJSON: function (path) {
        return $http.get(path);
      },

      //clean data of unneeded information and add styling information
      prepare: function (input) {
        var amountTopics = input.length,
          arr = [];

        //find most/least popular topic according to volume label
        var mostPopular = _.max(input, function (topics) {
          return topics.volume;
        });
        var leastPopular = _.min(input, function (topics) {
          return topics.volume;
        });

        //calculate range for sizing classes
        var classSizePopularity = (mostPopular.volume - leastPopular.volume) / 6;

        for (var i = 0; i < amountTopics; i++) {
          var obj = {};
          var currentTopic = input[i];

          //create new object only with key values for further processing
          obj = _.pick(currentTopic, 'label', 'volume', 'sentiment', 'sentimentScore');

          //add new values for viewing
          obj.popularityTextSize = setTextSize(currentTopic.volume, classSizePopularity);
          obj.randomAlignment = setRandomAlignment();
          obj.randomColumnSize = setRandomColumnSize();
          obj.sentimentTextColor = setSentimentTextColor(currentTopic);

          //push to array that gets send back to controller
          arr.push(obj);
        }

        // return and shuffle data for random positioning (biggest in the middle would also make sense - example looked shuffled)
        return _.shuffle(arr);
      }
    };

    return methods;
  }]);
</pre>

<h3>main.scss</h3>
<pre class="prettyprint linenums">
/* Space out content a bit */
body {
  padding-top: 20px;
  padding-bottom: 20px;
}

.footer {
  padding-left: 15px;
  padding-right: 15px;
}

/* Custom page header */
.header {
  border-bottom: 1px solid #e5e5e5;
}

/* Make the masthead heading the same height as the navigation */
.header h3 {
  margin-top: 0;
  margin-bottom: 0;
  line-height: 40px;
  padding-bottom: 19px;
}

/* Custom page footer */
.footer {
  padding-top: 19px;
  color: #777;
  border-top: 1px solid #e5e5e5;
}

/* Responsive: Portrait tablets and up */
@media screen and (min-width: 768px) {
  .container {
    max-width: 730px;
  }

  /* Remove the padding we set earlier */
  .header,
  .footer {
    padding-left: 0;
    padding-right: 0;
  }
  /* Space out the masthead */
  .header {
    margin-bottom: 30px;
  }
}

/* Minor custom stylings */
/* ordered alphabetically */

.info {
  font-weight: bold;
}

#love {
  margin-left: 2px;
  margin-right: 19px;
  height: 55px;
}

#negative-number {
  color: #ff0124;
}

#neutral-number {
  color: #696969;
}

.panel-body .word span:hover {
  cursor: pointer;
  opacity: 0.5;
}

.png {
  max-height: 70px;
}

#positive-number {
  color: #33be2a;
}

.prettyprint ol.linenums > li {
  list-style-type: decimal;
}

#statement {
  max-height: 80px;
  margin-top: 20px;
  text-align: center;
}

#topics-panel {
  margin: 60px 15px;
}

.word {
  margin: 0px;
  word-wrap: break-word;
  padding: 4px 2px;
  line-height: 0.9em;
}
</pre>

<div class="footer">
  <h3>Find this code on <a href="https://github.com/tillreiter/bw-challenge">Github</a></h3>
  <p>Tested on all common browsers with â™¥ from Till Reiter</p>
</div>
